
## Description

Rackspace Hosting - Autoscaling EC2 Instances with Rolling Updates and Notifications. **WARNING** This template creates one or more Amazon EC2  instances and an Elastic Load Balancer. You will be billed for the AWS resources used if you create a stack from this template.

#### Metadata

 * **AWS::CloudFormation::Interface**: {u'ParameterGroups': [{u'Parameters': [u'VPCID', u'AppSubnet', u'ELBSubnet'], u'Label': {u'default': u'Network Configuration'}}, {u'Parameters': [u'ELBCreation', u'ELBInstancePort', u'ELBInstanceProtocol', u'ELBLoadBalancerPort', u'ELBLoadBalancerProtocol', u'ELBSecondaryListener', u'ELB2ndInstancePort', u'ELB2ndInstanceProtocol', u'ELB2ndLoadBalancerPort', u'ELB2ndLoadBalancerProtocol', u'ELBHealthTarget', u'ELBHealthyThreshold', u'ELBUnHealthyThreshold', u'ELBHealthInterval', u'ELBHealthTimeout', u'ELBScheme', u'ELBCookieExpirationPeriod'], u'Label': {u'default': u'ELB Configuration'}}, {u'Parameters': [u'SSLIdCert'], u'Label': {u'default': u'ELB SSL Configuration'}}, {u'Parameters': [u'InstancesPublicIP', u'APPGroupName', u'Environment', u'DetailedMonitoring', u'EBSOptimized', u'InstanceType', u'Iops', u'EbsVolumeSize', u'EbsVolumeType', u'EncryptEBSVolume'], u'Label': {u'default': u'EC2 Instances Configuration'}}, {u'Parameters': [u'ScalingMin', u'ScalingMax', u'ScalingTermination', u'ScalingCreateTimeOut', u'ScalingUpdateTimeOut', u'EC2ScaleUpCooldown', u'EC2ScaleUpAdjustment', u'EC2ScaleDownCooldown', u'EC2ScaleDownAdjustment', u'HealthCheckGracePeriod', u'HealthCheckType', u'MinInstancesInService'], u'Label': {u'default': u'AutoScaling Configuration'}}, {u'Parameters': [u'CwCpuHighOperator', u'CwCpuHighPeriod', u'CwCpuHighEvaluations', u'CwCpuHighThreshold', u'CwCpuLowOperator', u'CwCpuLowPeriod', u'CwCpuLowEvaluations', u'CwCpuLowThreshold'], u'Label': {u'default': u'CloudWatch AutoScaling Alarm Configuration'}}]}
 * **Comments**: Generated by Ansible
 * **Version**: v1.0

## Parameters

 * **APPGroupName** - EC2 Server Instance Name
  * Constraint: `Must follow normal syntax conventions.`
 * **ASGSecurityGroupList** - A list that contains the EC2 security groups to assign to the Amazon EC2 instances in the Auto Scaling group.
 * **AppSubnet** - Subnets for Application
 * **CwCpuHighEvaluations** - The number of periods over which data is compared to the specified threshold.
  * Default: `2`
  * Constraint: `Must be a valid integer.`
 * **CwCpuHighOperator** - Math operator used by CloudWatch for alarms and triggers.
  * Default: `GreaterThanThreshold`
 * **CwCpuHighPeriod** - Time the specified statistic is applied. Must be in seconds that is also a multiple of 60.
  * Default: `300`
  * Constraint: `Must be a valid integer.`
 * **CwCpuHighThreshold** - The value against which the specified statistic is compared.
  * Default: `90`
  * Constraint: `Must be a valid integer.`
 * **CwCpuLowEvaluations** - The number of periods over which data is compared to the specified threshold.
  * Default: `2`
  * Constraint: `Must be a valid integer.`
 * **CwCpuLowOperator** - Math operator used by CloudWatch for alarms and triggers.
  * Default: `LessThanThreshold`
 * **CwCpuLowPeriod** - Time the specified statistic is applied. Must be in seconds that is also a multiple of 60.
  * Default: `300`
  * Constraint: `Must be a valid integer.`
 * **CwCpuLowThreshold** - The value against which the specified statistic is compared.
  * Default: `50`
  * Constraint: `Must be a valid integer.`
 * **DetailedMonitoring** - Enable Detailed Monitoring.
  * Default: `True`
 * **EBSOptimized** - Use EBS Optimized.
  * Default: `False`
 * **EC2ScaleDownAdjustment** - Number of EC2 instances to scale down by at a time.
  * Default: `1`
  * Constraint: `Must be a valid integer.`
 * **EC2ScaleDownCooldown** - Time in seconds before any further trigger-related scaling can occur.
  * Default: `60`
  * Constraint: `Must be a valid integer.`
 * **EC2ScaleUpAdjustment** - Number of EC2 instances to scale up by at a time.
  * Default: `1`
  * Constraint: `Must be a valid integer.`
 * **EC2ScaleUpCooldown** - Time in seconds before any further trigger-related scaling can occur.
  * Default: `60`
  * Constraint: `Must be a valid integer.`
 * **ELB2ndInstancePort** - Specifies the 2nd TCP port on which the instance server is listening.
  * Default: `443`
  * Constraint: `Must be a valid integer.`
 * **ELB2ndInstanceProtocol** - Specifies the 2nd protocol to use for routing traffic to back-end instances HTTP / HTTPS / TCP / SSL.
  * Default: `HTTPS`
 * **ELB2ndLoadBalancerPort** - Specifies the 2nd external load balancer port number.
  * Default: `443`
  * Constraint: `Must be a valid integer.`
 * **ELB2ndLoadBalancerProtocol** - Specifies the 2nd protocol to use for the Load Balancer HTTP / HTTPS / TCP / SSL.
  * Default: `HTTPS`
 * **ELBConnectionDrainingTimeout** - Set the timeout value for elastic loadbalancer draining policy if desired. OPTIONAL
  * Default: `0`
 * **ELBCookieExpirationPeriod** - Generates a stickiness policy with sticky session lifetimes controlled by a specified expiration period. Leave blank not to use.
  * Default: ``
 * **ELBCreation** - Specifies whether to create an ELB or not as part of this deployment.
  * Default: `True`
 * **ELBHealthInterval** - Seconds between health checks.
  * Default: `30`
  * Constraint: `Must be a valid integer.`
 * **ELBHealthTarget** - Protocol & port check on instance. TCP:5000 | SSL:5000 || HTTP(S) = HTTP:80/path/to/my/file.
  * Default: `TCP:80`
 * **ELBHealthTimeout** - Number of seconds during which no response means a failed health probe.
  * Default: `5`
  * Constraint: `Must be a valid integer.`
 * **ELBHealthyThreshold** - Consecutive successful checks before marking instance healthy.
  * Default: `3`
  * Constraint: `Must be a valid integer.`
 * **ELBInstancePort** - Specifies the TCP port on which the instance server is listening.
  * Default: `80`
  * Constraint: `Must be a valid integer.`
 * **ELBInstanceProtocol** - Specifies the protocol to use for routing traffic to back-end instances HTTP / HTTPS / TCP / SSL.
  * Default: `HTTP`
 * **ELBLoadBalancerPort** - Specifies the external load balancer port number.
  * Default: `80`
  * Constraint: `Must be a valid integer.`
 * **ELBLoadBalancerProtocol** - Specifies the protocol to use for the Load Balancer HTTP / HTTPS / TCP / SSL.
  * Default: `HTTP`
 * **ELBLogAccessControl** - Define ACL for Bucket
  * Default: `BucketOwnerFullControl`
  * Constraint: `Must be either AuthenticatedRead, AwsExecRead, BucketOwnerRead, BucketOwnerFullControl, LogDeliveryWrite, Private, PublicRead or PublicReadWrite.`
 * **ELBLogBucketName** - The name of the bucket to use for ELB logs. Must be unique.
  * Default: ``
  * Constraint: `The bucket name must contain only lowercase letters, numbers, periods (.), and dashes (-).`
 * **ELBScheme** - Specifies whether to create an internal ELB or a public facing one.
  * Default: `internet-facing`
 * **ELBSecondaryListener** - Enable Secondary Listener on the Load Balancer
  * Default: `False`
 * **ELBSecurityGroupList** - A list of security groups assigned to your load balancer within your virtual private cloud (VPC).
 * **ELBSubnet** - Subnets for Elastic Loadbalancer ** REQUIRED even if ELBCreation is False **
 * **ELBUnHealthyThreshold** - Consecutive failed checks before marking instance unhealthy.
  * Default: `5`
  * Constraint: `Must be a valid integer.`
 * **EbsVolumeSize** - Select EBS Volume Size in GB.
  * Default: `60`
 * **EbsVolumeType** - Select EBS Volume Type.
  * Default: `gp2`
 * **EncryptEBSVolume** - Specifies whether to encrypt the EBS volume.
  * Default: `False`
 * **Environment** - Application environment for which this network is being created. e.g. Development/Production.
  * Default: `Development`
 * **HealthCheckGracePeriod** - Number of seconds grace during which no autoscaling actions will be taken.
  * Default: `300`
  * Constraint: `Must be a valid integer.`
 * **HealthCheckType** - Define the type of healthcheck for the AutoScaling group.
  * Default: `EC2`
 * **ImageId** - The image ID to be used to build the Auto Scale group. OPTIONAL
  * Default: ``
 * **InstanceType** - Select instance type
  * Default: `t2.micro`
  * Constraint: `Must be a valid EC2 instance type. Default is t2.micro`
 * **InstancesPublicIP** - Specifies whether to launch instances with public IP addresses in your VPC.
  * Default: `False`
 * **Iops** - Iops value required for use with io1 EBS volumes. This value should be 3 times the EBS volume size
  * Default: `0`
 * **KeyName** - Name of an existing EC2 KeyPair to enable SSH access to the instances.
  * Constraint: `Must be the name of an existing EC2 KeyPair.`
 * **MinInstancesInService** - Specifies the minimum number of instances that must be in service within the Auto Scaling group while AWS CloudFormation updates old instances.
  * Default: `0`
 * **SSLIdCert** - SSL Certificate Name. Full ARN required.
  * Default: `0`
  * Constraint: `Must be an existing SSL Name.`
 * **ScalingCreateTimeOut** - Time to wait for the number of signals equal to ScalingMin. H/M/S Hours/Minutes/Seconds
  * Default: `20M`
  * Constraint: `#H#M#S where each # is the number of hours or minutes or seconds`
 * **ScalingMax** - The maximum size of the Auto Scaling group.
  * Default: `2`
  * Constraint: `Must be a valid integer.`
 * **ScalingMin** - The minimum size of the Auto Scaling group.
  * Default: `1`
  * Constraint: `Must be a valid integer.`
 * **ScalingNotificationEmail** - EMail address to notify if there are any scaling operations. OPTIONAL
  * Default: `noemail@email.com`
  * Constraint: `Must be a valid email address.`
 * **ScalingTermination** - The maximum number of instances that are terminated at a given time.
  * Default: `1`
  * Constraint: `Must be a valid integer.`
 * **ScalingUpdateTimeOut** - Post update pause before additional Auto Scale resource changes. H/M/S Hours/Minutes/Seconds
  * Default: `20M`
  * Constraint: `#H#M#S where each # is the number of hours or minutes or seconds`
 * **VPCID** - Select Virtual Private Cloud ID
 * **directoryId** - Directory ID of managed Active Directory.
 * **directoryName** - Full name of Active Directory Domain.
 * **dnsIpAddresses** - IP addresses of the Active Directory DNS servers.
 * **waitAfterCompletion** - Time to wait when associating SSM document.
  * Default: `forever`

## Conditions

 * **DetailedMonitoring** - `{u'Fn::Equals': [{u'Ref': u'DetailedMonitoring'}, u'True']}`
 * **ELBCookieStickinessPolicy** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'ELBCookieExpirationPeriod'}, u'']}]}`
 * **ELBEnabled** - `{u'Fn::Equals': [{u'Ref': u'ELBCreation'}, u'True']}`
 * **IopsEnabled** - `{u'Fn::Equals': [{u'Ref': u'EbsVolumeType'}, u'io1']}`
 * **SSL2ndEnabled** - `{u'Fn::Or': [{u'Fn::Equals': [{u'Ref': u'ELB2ndLoadBalancerProtocol'}, u'SSL']}, {u'Fn::Equals': [{u'Ref': u'ELB2ndLoadBalancerProtocol'}, u'HTTPS']}]}`
 * **SSLEnabled** - `{u'Fn::Or': [{u'Fn::Equals': [{u'Ref': u'ELBLoadBalancerProtocol'}, u'SSL']}, {u'Fn::Equals': [{u'Ref': u'ELBLoadBalancerProtocol'}, u'HTTPS']}]}`
 * **isEBSEncrypted** - `{u'Fn::Equals': [{u'Ref': u'EncryptEBSVolume'}, u'True']}`
 * **isELB2ndListener** - `{u'Fn::Equals': [{u'Ref': u'ELBSecondaryListener'}, u'True']}`
 * **isELBConnectionDrain** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'ELBConnectionDrainingTimeout'}, u'0']}]}`
 * **isELBLogging** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'ELBLogBucketName'}, u'']}]}`
 * **isImageId** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'ImageId'}, u'']}]}`
 * **isMinInstance** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'MinInstancesInService'}, u'0']}]}`
 * **isScalingNotification** - `{u'Fn::Not': [{u'Fn::Equals': [{u'Ref': u'ScalingNotificationEmail'}, u'noemail@email.com']}]}`

## Mappings

 * **AWSRegionArch2AMI**:
  * `(u'ap-south-1', {u'64': u'ami-75fe8b1a'})`
  * `(u'us-east-1', {u'64': u'ami-ee7805f9'})`
  * `(u'ap-northeast-1', {u'64': u'ami-fffd2c9e'})`
  * `(u'ap-southeast-2', {u'64': u'ami-899eafea'})`
  * `(u'eu-west-1', {u'64': u'ami-9b81f8e8'})`
  * `(u'ap-southeast-1', {u'64': u'ami-ac5389cf'})`
  * `(u'ap-northeast-2', {u'64': u'ami-ee20f580'})`
  * `(u'us-west-2', {u'64': u'ami-2827f548'})`
  * `(u'us-west-1', {u'64': u'ami-c06b24a0'})`
  * `(u'eu-central-1', {u'64': u'ami-7248ba1d'})`
  * `(u'sa-east-1', {u'64': u'ami-8e2fbfe2'})`

## Resources

 * **AutoScaleGrp** - `AWS::AutoScaling::AutoScalingGroup`
 * **CPUAlarmHigh** - `AWS::CloudWatch::Alarm`
 * **CPUAlarmLow** - `AWS::CloudWatch::Alarm`
 * **EC2ScaleDownPolicy** - `AWS::AutoScaling::ScalingPolicy`
 * **EC2ScaleUpPolicy** - `AWS::AutoScaling::ScalingPolicy`
 * **ELBS3LoggingBucketPolicy** - `AWS::S3::BucketPolicy`
 * **ElasticLoadBalancer** - `AWS::ElasticLoadBalancing::LoadBalancer`
 * **InstanceRole** - `AWS::IAM::Role`
 * **InstanceRoleInstanceProfile** - `AWS::IAM::InstanceProfile`
 * **InstanceRolePolicies** - `AWS::IAM::Policy`
 * **LaunchConfig** - `AWS::AutoScaling::LaunchConfiguration`
 * **NotificationTopic** - `AWS::SNS::Topic`
 * **S3BucketwithLogging** - `AWS::S3::Bucket`
 * **SSMDocument** - `AWS::SSM::Document`
 * **UnHealthyHostCountAlarm** - `AWS::CloudWatch::Alarm`

## Outputs

 * **URL** - `{u'Fn::Join': [u'', [u'http://', {u'Fn::GetAtt': [u'ElasticLoadBalancer', u'DNSName']}]]}`