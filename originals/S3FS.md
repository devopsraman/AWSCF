
## Description

Rackspace Hosting - Creates the necessary S3 bucket, IAM Role, and IAM Instance Profile for using the s3fs-fuse mount. Additional steps are required to use this template. Please be aware that this template will create resources for which you will be charged.
## s3fs-fuse



[s3fs-fuse](https://github.com/s3fs-fuse/s3fs-fuse) is a temporary solution for customers to utilize a shared file storage mount. When [Elastic File System](https://aws.amazon.com/efs/) is released this option will no longer be supported.



Generally S3 cannot offer the same performance or semantics as a local file system.  More specifically:



* poor write performance

* good read performance if used with the `-o use_cache=/tmp` mounting option

* random writes or appends to files require rewriting the entire file

* metadata operations such as listing directories have poor performance due to network latency

* [eventual consistency](https://en.wikipedia.org/wiki/Eventual_consistency) can temporarily yield stale data

* no atomic renames of files or directories

* no coordination between multiple clients mounting the same bucket

* no hard links



## cloud-init



```

#!/bin/bash

yum install automake fuse-devel gcc-c++ git libcurl-devel libxml2-devel make openssl-devel fuse -y

git clone https://github.com/s3fs-fuse/s3fs-fuse.git

cd s3fs-fuse

./autogen.sh

./configure

make

make install



mkdir -p /media/s3fs

```



The stack will output the full `MountCommand`. Keep in mind you may need to reference a different IAM Role to match the Role assigned to the EC2 instance.



## fstab



```

s3fs#bucketname /media/s3fs fuse _netdev,allow_other,use_cache=/tmp,iam_role=IAMRole 0 0

```


#### Metadata

 * **Comments**: Generated by Ansible
 * **Version**: v0.1.0

## Parameters

 * **BucketName** - The name of the bucket to use for the s3fs-fuse mount. Must be unique.
  * Constraint: `The bucket name must contain only lowercase letters, numbers, periods (.), and dashes (-).`
 * **Environment** - Application environment for which this network is being created. e.g. Development/Production.
  * Default: `Development`
 * **SSHKeyPair** - Select the name of a pre-created SSH Key used for instance OS access.
  * Constraint: `Must be the name of an existing EC2 KeyPair.`
 * **Versioning** - Enable versioning for the S3 bucket.
  * Default: `Enabled`

## Resources

 * **IAMRoleS3FS** - `AWS::IAM::Role`
 * **S3Bucket** - `AWS::S3::Bucket`
 * **S3FSIAMPolicy** - `AWS::IAM::ManagedPolicy`
 * **S3FSInstanceProfile** - `AWS::IAM::InstanceProfile`

## Outputs

 * **Bucket** - `{u'Ref': u'S3Bucket'}`
 * **IAMRole** - `{u'Ref': u'IAMRoleS3FS'}`
 * **InstanceProfile** - `{u'Ref': u'S3FSInstanceProfile'}`
 * **MountCommand** - `{u'Fn::Join': [u'', [u's3fs ', {u'Ref': u'S3Bucket'}, u' /path/to/mountpoint -o iam_role=', {u'Ref': u'IAMRoleS3FS'}, u' -o use_cache=/tmp']]}`