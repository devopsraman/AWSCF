<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<h1 id="albwafattachment-faws-template">AlbWafAttachment FAWS Template</h1>
<p>ALB_waf_attachment.template - Elastic Load Balancer v2 (Application Load Balancer) template. ### Parameters</p>
<h4 id="vpcid">VPCID</h4>
<ul>
<li>Type: <code>AWS::EC2::VPC::Id</code></li>
<li>Description: <code>The VPC in which your targets are located.</code></li>
</ul>
<h4 id="targetgroupport">TargetGroupPort</h4>
<ul>
<li>Default: <code>80</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port on which the targets receive traffic.</code></li>
<li>MaxValue: <code>65535</code></li>
</ul>
<h4 id="attributedelaytimeout">AttributeDelayTimeout</h4>
<ul>
<li>Default: <code>30</code></li>
<li>MinValue: <code>0</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The amount time for Elastic Load Balancing to wait before changing the state of a deregistering target from draining to unused.</code></li>
<li>MaxValue: <code>3600</code></li>
</ul>
<h4 id="listener2ssl">Listener2SSL</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The Amazon Resource Name (ARN) of the default certificate(s) to associate with listener 2. (OPTIONAL)</code></li>
</ul>
<h4 id="healthcheckintervalseconds">HealthCheckIntervalSeconds</h4>
<ul>
<li>Default: <code>30</code></li>
<li>MinValue: <code>5</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The approximate number of seconds between health checks for an individual target.</code></li>
<li>MaxValue: <code>300</code></li>
</ul>
<h4 id="environment">Environment</h4>
<ul>
<li>Default: <code>Development</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Application environment for which this network is being created. e.g. Development/Production.</code></li>
<li>AllowedValues: <code>['Development', 'Integration', 'PreProduction', 'Production', 'Staging', 'Test']</code></li>
</ul>
<h4 id="listener1ssl">Listener1SSL</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The Amazon Resource Name (ARN) of the default certificate(s) to associate with listener 1. (OPTIONAL)</code></li>
</ul>
<h4 id="internalrecordname">InternalRecordName</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>Record Name for the new Resource Record in the Internal Hosted Zone</code></li>
</ul>
<h4 id="scheme">Scheme</h4>
<ul>
<li>Default: <code>internet-facing</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Indicates whether the load balancer is Internet-facing or internal.</code></li>
<li>AllowedValues: <code>['internet-facing', 'internal']</code></li>
</ul>
<h4 id="cookieduration">CookieDuration</h4>
<ul>
<li>Default: <code>86400</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The time period, in seconds, during which requests from a client should be routed to the same target.</code></li>
<li>MaxValue: <code>604800</code></li>
</ul>
<h4 id="subnets">Subnets</h4>
<ul>
<li>Type: <code>List&lt;AWS::EC2::Subnet::Id&gt;</code></li>
<li>Description: <code>A list of at least two IDs of the subnets to associate with the load balancer.</code></li>
</ul>
<h4 id="enablerackspaceticket">EnableRackspaceTicket</h4>
<ul>
<li>Default: <code>False</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Specifies whether alarms will generate Rackspace tickets</code></li>
<li>AllowedValues: <code>['False', 'True']</code></li>
</ul>
<h4 id="listener1protocol">Listener1Protocol</h4>
<ul>
<li>Default: <code>HTTP</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The protocol that clients must use to send requests to the listener.</code></li>
<li>AllowedValues: <code>['HTTP', 'HTTPS']</code></li>
</ul>
<h4 id="targetgrouptargetport2">TargetGroupTargetPort2</h4>
<ul>
<li>Default: <code>80</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port number on which the target is listening for traffic.</code></li>
<li>MaxValue: <code>65535</code></li>
</ul>
<h4 id="targetgrouptype">TargetGroupType</h4>
<ul>
<li>Default: <code>ASG</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The type of target. (ASG\ECS or Instance)</code></li>
<li>AllowedValues: <code>['ASG', 'Instance']</code></li>
</ul>
<h4 id="createloggingbucket">CreateLoggingBucket</h4>
<ul>
<li>Default: <code>true</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Create a new S3 logging bucket.</code></li>
<li>AllowedValues: <code>['true', 'false']</code></li>
</ul>
<h4 id="targetgroupprotocol">TargetGroupProtocol</h4>
<ul>
<li>Default: <code>HTTP</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The protocol to use for routing traffic to the targets.</code></li>
<li>AllowedValues: <code>['HTTP', 'HTTPS']</code></li>
</ul>
<h4 id="internalzonename">InternalZoneName</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>TLD for Internal Hosted Zone</code></li>
</ul>
<h4 id="securitygroups">SecurityGroups</h4>
<ul>
<li>Type: <code>List&lt;AWS::EC2::SecurityGroup::Id&gt;</code></li>
<li>Description: <code>A list of the IDs of the security groups to assign to the load balancer.</code></li>
</ul>
<h4 id="healthcheckprotocol">HealthCheckProtocol</h4>
<ul>
<li>Default: <code>HTTP</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The protocol that the load balancer uses when performing health checks on the targets, such as HTTP or HTTPS.</code></li>
<li>AllowedValues: <code>['HTTP', 'HTTPS']</code></li>
</ul>
<h4 id="targetgrouptargetid1">TargetGroupTargetId1</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The ID of the target, such as an EC2 instance ID.</code></li>
</ul>
<h4 id="targetgrouptargetid2">TargetGroupTargetId2</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The ID of the target, such as an EC2 instance ID.</code></li>
</ul>
<h4 id="targetgrouptargetid3">TargetGroupTargetId3</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The ID of the target, such as an EC2 instance ID.</code></li>
</ul>
<h4 id="listener2port">Listener2Port</h4>
<ul>
<li>Default: <code>443</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port on which the listener listens for requests.</code></li>
</ul>
<h4 id="s3bucketprefix">S3BucketPrefix</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The prefix for the location in the S3 bucket. If you don't specify a prefix, the access logs are stored in the root of the bucket.</code></li>
</ul>
<h4 id="listener2protocol">Listener2Protocol</h4>
<ul>
<li>Default: <code>HTTPS</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The protocol that clients must use to send requests to the listener.</code></li>
<li>AllowedValues: <code>['HTTP', 'HTTPS']</code></li>
</ul>
<h4 id="webaclid">WebACLId</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The unique identifier (ID) for the Web Application Firewall ACL. (OPTIONAL)</code></li>
</ul>
<h4 id="matchercode">MatcherCode</h4>
<ul>
<li>Default: <code>200-299</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The HTTP codes. The default value is 200.</code></li>
</ul>
<h4 id="listener1port">Listener1Port</h4>
<ul>
<li>Default: <code>80</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port on which the listener listens for requests.</code></li>
</ul>
<h4 id="listener2sslpolicy">Listener2SSLPolicy</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The security policy that defines which ciphers and protocols are supported. The default is the current predefined security policy. More information: http://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies.</code></li>
</ul>
<h4 id="loadbalancername">LoadBalancerName</h4>
<ul>
<li>Default: <code>ALB-LoadBalancer-Name</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>A name for the load balancer, which must be unique within your AWS account.</code></li>
</ul>
<h4 id="healthcheckpath">HealthCheckPath</h4>
<ul>
<li>Default: <code>/</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The ping path destination where Elastic Load Balancing sends health check requests.</code></li>
<li>MaxLength: <code>1024</code></li>
</ul>
<h4 id="healthchecktimeoutseconds">HealthCheckTimeoutSeconds</h4>
<ul>
<li>Default: <code>5</code></li>
<li>MinValue: <code>2</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The number of seconds to wait for a response before considering that a health check has failed.</code></li>
<li>MaxValue: <code>60</code></li>
</ul>
<h4 id="attributestickinessenabled">AttributeStickinessEnabled</h4>
<ul>
<li>Default: <code>true</code></li>
<li>Type: <code>String</code></li>
<li>ConstraintDescription: <code>Value must be either lowercase true or false.</code></li>
<li>Description: <code>Indicates whether sticky sessions are enabled.</code></li>
<li>AllowedValues: <code>['true', 'false']</code></li>
</ul>
<h4 id="healthcheckport">HealthCheckPort</h4>
<ul>
<li>Default: <code>traffic-port</code></li>
<li>Type: <code>String</code></li>
<li>Description: ``</li>
</ul>
<h4 id="unhealthythresholdcount">UnhealthyThresholdCount</h4>
<ul>
<li>Default: <code>2</code></li>
<li>MinValue: <code>2</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The number of consecutive failed health checks that are required before a target is considered unhealthy.</code></li>
<li>MaxValue: <code>10</code></li>
</ul>
<h4 id="s3logdeletionprotection">S3LogDeletionProtection</h4>
<ul>
<li>Default: <code>false</code></li>
<li>Type: <code>String</code></li>
<li>ConstraintDescription: <code>Value must be either lowercase true or false.</code></li>
<li>Description: <code>Indicates whether deletion protection is enabled.</code></li>
<li>AllowedValues: <code>['true', 'false']</code></li>
</ul>
<h4 id="healthythresholdcount">HealthyThresholdCount</h4>
<ul>
<li>Default: <code>5</code></li>
<li>MinValue: <code>2</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The number of consecutive successful health checks that are required before an unhealthy target is considered healthy.</code></li>
<li>MaxValue: <code>10</code></li>
</ul>
<h4 id="logretention">LogRetention</h4>
<ul>
<li>Default: <code>14</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The number of days to retain load balancer logs.  Parameter is ignored if not creating a new S3 bucket.</code></li>
<li>MaxValue: <code>999</code></li>
</ul>
<h4 id="listener1sslpolicy">Listener1SSLPolicy</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The security policy that defines which ciphers and protocols are supported. The default is the current predefined security policy. More information: http://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#describe-ssl-policies.</code></li>
</ul>
<h4 id="enablelistener1">EnableListener1</h4>
<ul>
<li>Default: <code>True</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Enable Primary Listener on the Load Balancer</code></li>
<li>AllowedValues: <code>['True', 'False']</code></li>
</ul>
<h4 id="enablelistener2">EnableListener2</h4>
<ul>
<li>Default: <code>False</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>Enable Primary Listener on the Load Balancer</code></li>
<li>AllowedValues: <code>['True', 'False']</code></li>
</ul>
<h4 id="logaccesscontrol">LogAccessControl</h4>
<ul>
<li>Default: <code>BucketOwnerFullControl</code></li>
<li>Type: <code>String</code></li>
<li>ConstraintDescription: <code>Must be either AuthenticatedRead, AwsExecRead, BucketOwnerRead, BucketOwnerFullControl, LogDeliveryWrite, Private, PublicRead or PublicReadWrite.</code></li>
<li>Description: <code>Define ACL for Bucket.</code></li>
<li>AllowedValues: <code>['AuthenticatedRead', 'AwsExecRead', 'BucketOwnerRead', 'BucketOwnerFullControl', 'LogDeliveryWrite', 'Private', 'PublicRead', 'PublicReadWrite']</code></li>
</ul>
<h4 id="s3bucketname">S3BucketName</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The name of the S3 bucket for the access logs.</code></li>
</ul>
<h4 id="timeout">TimeOut</h4>
<ul>
<li>Default: <code>60</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The idle timeout value, in seconds. The valid range is 1-3600. The default is 60 seconds.</code></li>
<li>MaxValue: <code>3600</code></li>
</ul>
<h4 id="listenersnicertificates">ListenerSNICertificates</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>CommaDelimitedList</code></li>
<li>Description: <code>A comma delimited list of Amazon Resource Names (ARNs).  Each ARN should point to an SSL certificate(s) to associate with any listener assigned a default certificate.</code></li>
</ul>
<h4 id="listenersnicertificatescount">ListenerSNICertificatesCount</h4>
<ul>
<li>Default: <code>0</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>The number of additional SNI certificate ARNs provided.  If more than 5 are required, please use ALB_ListenerCertificate.template</code></li>
<li>AllowedValues: <code>[0, 1, 2, 3, 4, 5]</code></li>
</ul>
<h4 id="loadbalancernameversion">LoadBalancerNameVersion</h4>
<ul>
<li>Default: <code>v00</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>NOTE: This needs to increment on update with new ALB.</code></li>
</ul>
<h4 id="internalzoneid">InternalZoneId</h4>
<ul>
<li>Default: ``</li>
<li>Type: <code>String</code></li>
<li>Description: <code>The Route53 Internal Hosted Zone ID</code></li>
</ul>
<h4 id="targetgrouptargetport1">TargetGroupTargetPort1</h4>
<ul>
<li>Default: <code>80</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port number on which the target is listening for traffic.</code></li>
<li>MaxValue: <code>65535</code></li>
</ul>
<h4 id="targetgroupname">TargetGroupName</h4>
<ul>
<li>Default: <code>ALB-TargetGroup</code></li>
<li>Type: <code>String</code></li>
<li>Description: <code>A name for the Default Target Group.</code></li>
</ul>
<h4 id="targetgrouptargetport3">TargetGroupTargetPort3</h4>
<ul>
<li>Default: <code>80</code></li>
<li>MinValue: <code>1</code></li>
<li>Type: <code>Number</code></li>
<li>Description: <code>The port number on which the target is listening for traffic.</code></li>
<li>MaxValue: <code>65535</code></li>
</ul>
<h3 id="outputs">Outputs</h3>
<ul>
<li><code>ELBv2TargetGroupInstance</code></li>
<li><code>ELBv2LoadBalancerFullName</code></li>
<li><code>ELBv2</code></li>
<li><code>ELBv2TargetGroupASG</code></li>
<li><code>S3BucketName</code></li>
<li><code>UnHealthyHostCountAlarm</code></li>
<li><code>ELBv2Listener2</code></li>
<li><code>ELBv2Listener1</code></li>
</ul>
<h3 id="alarms">Alarms</h3>
<h4 id="unhealthyhostcountalarm">UnHealthyHostCountAlarm</h4>
<ul>
<li>Description: Unhealthy Host count is above threshold, creating ticket.</li>
<li>Metric: UnHealthyHostCount</li>
<li>Threshold: 1</li>
<li>Actions: <code>{'Fn::If': ['RackspaceAlarmsEnabled', {'Fn::Sub': 'arn:aws:sns:${AWS::Region}:${AWS::AccountId}:rackspace-support-emergency'}, {'Ref': 'AWS::NoValue'}]}</code></li>
</ul>
</body>
</html>
